<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MindEase</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js"></script>

  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
    .nav-item.active { background-color: #3b82f6; color: white; }
    .main-content > div { display: none; }
    .main-content > div.active { display: block; }
    .chat-bubble { max-width: 80%; padding: 12px 16px; border-radius: 20px; }
    .chat-bubble-user { background-color: #3b82f6; color: white; align-self: flex-end; }
    .chat-bubble-ai { background-color: #e5e7eb; color: #1f2937; align-self: flex-start; }
    #breathing-circle { transition: transform 4s ease-in-out; }
  </style>
</head>

<body class="antialiased text-gray-800">

<div id="app-container" class="max-w-4xl mx-auto min-h-screen bg-white shadow-lg flex flex-col md:flex-row">

  <aside class="w-full md:w-1/5 bg-blue-500 text-white p-4 flex flex-col">
    <h1 class="text-2xl font-bold mb-6">MindEase</h1>
    <nav class="flex flex-col gap-2">
      <button data-target="home" class="nav-item p-3 rounded-lg active">Home</button>
      <button data-target="journal" class="nav-item p-3 rounded-lg">Journal</button>
      <button data-target="meditate" class="nav-item p-3 rounded-lg">Meditate</button>
      <button data-target="chat" class="nav-item p-3 rounded-lg">Chatbot</button>
      <button data-target="goals" class="nav-item p-3 rounded-lg">Goals</button>
      <button data-target="settings" class="nav-item p-3 rounded-lg">Settings</button>
    </nav>
    <div id="auth-status" class="mt-auto text-center text-xs">Connecting...</div>
  </aside>

  <main class="flex-1 p-6 bg-gray-50 overflow-y-auto">
    <div class="main-content">

      <div id="home" class="active">
        <h2 class="text-3xl font-bold mb-4">Welcome to MindEase</h2>
        <p class="text-gray-600">A space to track mood, meditate, and talk to your AI companion.</p>
      </div>

      <div id="journal">
        <h2 class="text-3xl font-bold mb-6">Journal</h2>
        <select id="mood-select" class="p-2 border rounded-md">
          <option>ğŸ˜Š Happy</option><option>ğŸ™‚ Content</option><option>ğŸ˜ Neutral</option>
          <option>ğŸ˜” Sad</option><option>ğŸ˜  Angry</option><option>ğŸ˜° Anxious</option>
        </select>
        <textarea id="journal-entry" class="w-full p-3 border rounded-md mt-4" rows="5"></textarea>
        <button id="save-journal-entry" class="mt-4 bg-blue-500 text-white px-6 py-2 rounded-lg">Save</button>
        <h3 class="text-xl font-bold mt-6 mb-3">Entries</h3>
        <div id="journal-list"></div>
      </div>

      <div id="meditate">
        <h2 class="text-3xl font-bold mb-6">Guided Meditation & Breathing</h2>

        <div id="meditation-list" class="grid grid-cols-1 gap-4">
          <button class="p-4 bg-white shadow rounded-md" onclick="startMeditation('box')">Box Breathing</button>
        </div>

        <div id="meditation-player" class="hidden bg-white shadow p-6 rounded-md text-center">
          <h3 id="player-title" class="text-2xl font-semibold"></h3>
          <p id="player-description" class="text-gray-600 mb-6"></p>
          <div id="breathing-circle" class="w-40 h-40 rounded-full bg-blue-300 mx-auto mb-6"></div>
          <p id="breathing-text" class="text-xl font-semibold mb-6"></p>
          <button id="stop-meditation" class="bg-red-500 text-white px-6 py-2 rounded-lg">Stop</button>
        </div>
      </div>

      <div id="chat" class="flex flex-col h-[calc(100vh-150px)]">
        <h2 class="text-3xl font-bold mb-4">AI Wellness Chat</h2>
        <div id="chat-window" class="flex-1 bg-gray-100 p-4 rounded-lg overflow-y-auto"></div>
        <input id="chat-input" class="p-3 border rounded-md mt-3" placeholder="Type...">
      </div>

      <div id="goals">
        <h2 class="text-3xl font-bold mb-4">Goals</h2>
      </div>

      <div id="settings">
        <h2 class="text-3xl font-bold mb-4">Settings</h2>
      </div>

    </div>
  </main>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

/* âœ… INSERT YOUR FIREBASE CONFIG BELOW */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID"
};
/* ----------------------------------- */

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
let userId = null;

onAuthStateChanged(auth, async (u) => {
  if (u) {
    userId = u.uid;
    document.getElementById("auth-status").textContent = "Connected";
    loadEntries();
  } else {
    await signInAnonymously(auth);
  }
});

document.getElementById("save-journal-entry").onclick = async () => {
  if (!userId) return;
  await addDoc(collection(db, `users/${userId}/journal`), {
    mood: document.getElementById("mood-select").value,
    text: document.getElementById("journal-entry").value,
    createdAt: serverTimestamp()
  });
  document.getElementById("journal-entry").value = "";
};

function loadEntries() {
  const q = query(collection(db, `users/${userId}/journal`), orderBy("createdAt", "desc"));
  onSnapshot(q, snap => {
    const list = document.getElementById("journal-list");
    list.innerHTML = "";
    snap.forEach(doc => {
      const e = doc.data();
      const div = document.createElement("div");
      div.className = "p-3 bg-white shadow my-2 rounded";
      div.textContent = `${e.mood} - ${e.text}`;
      list.append(div);
    });
  });
}

let synth, meditationInterval;

window.startMeditation = function() {
  document.getElementById("meditation-list").classList.add("hidden");
  document.getElementById("meditation-player").classList.remove("hidden");
  document.getElementById("player-title").innerText = "Box Breathing";
  document.getElementById("player-description").innerText = "Inhale 4s, Hold 4s, Exhale 4s, Hold 4s";

  Tone.start().then(() => synth = new Tone.Synth().toDestination());

  let steps = [
    ["Inhale", 1.3],
    ["Hold", 1.3],
    ["Exhale", 0.8],
    ["Hold", 0.8]
  ];
  let i = 0;
  function breathe() {
    let [txt, scale] = steps[i % 4];
    document.getElementById("breathing-text").innerText = txt;
    document.getElementById("breathing-circle").style.transform = `scale(${scale})`;
    if (synth) synth.triggerAttackRelease("C4", "8n");
    i++;
  }
  breathe();
  meditationInterval = setInterval(breathe, 4000);
};

document.getElementById("stop-meditation").onclick = () => {
  clearInterval(meditationInterval);
  if (synth) synth.dispose();
  document.getElementById("meditation-player").classList.add("hidden");
  document.getElementById("meditation-list").classList.remove("hidden");
};

document.querySelectorAll(".nav-item").forEach(btn => btn.onclick = () => {
  document.querySelectorAll(".nav-item").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  const t = btn.dataset.target;
  document.querySelectorAll(".main-content > div").forEach(s => s.classList.toggle("active", s.id === t));
});
</script>

</body>
</html>
